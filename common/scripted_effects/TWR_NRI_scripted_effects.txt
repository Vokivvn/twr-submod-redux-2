NRI_norilsk_campaign_initial = {
	# Nothern Section
	1 = {
		set_variable = { 1.NRI_faction_control@THIS = 25 }
		set_variable = { 1.NRI_faction_resource@THIS = 50 }
		set_variable = { 2.NRI_faction_control@THIS = 25 }
		set_variable = { 2.NRI_faction_resource@THIS = 50 }
		set_variable = { 3.NRI_faction_control@THIS = 25 }
		set_variable = { 3.NRI_faction_resource@THIS = 50 }
		set_variable = { 4.NRI_faction_control@THIS = 25 }
		set_variable = { 4.NRI_faction_resource@THIS = 50 }
	}

	# Southern Section
	2 = {
		set_variable = { 1.NRI_faction_control@THIS = 25 }
		set_variable = { 1.NRI_faction_resource@THIS = 50 }
		set_variable = { 2.NRI_faction_control@THIS = 25 }
		set_variable = { 2.NRI_faction_resource@THIS = 50 }
		set_variable = { 3.NRI_faction_control@THIS = 25 }
		set_variable = { 3.NRI_faction_resource@THIS = 50 }
		set_variable = { 4.NRI_faction_control@THIS = 25 }
		set_variable = { 4.NRI_faction_resource@THIS = 50 }
	}

	# Northwestern Section
	3 = {
		set_variable = { 1.NRI_faction_control@THIS = 25 }
		set_variable = { 1.NRI_faction_resource@THIS = 50 }
		set_variable = { 2.NRI_faction_control@THIS = 25 }
		set_variable = { 2.NRI_faction_resource@THIS = 50 }
		set_variable = { 3.NRI_faction_control@THIS = 25 }
		set_variable = { 3.NRI_faction_resource@THIS = 50 }
		set_variable = { 4.NRI_faction_control@THIS = 25 }
		set_variable = { 4.NRI_faction_resource@THIS = 50 }
	}

	# Lakeside
	4 = {
		set_variable = { 1.NRI_faction_control@THIS = 25 }
		set_variable = { 1.NRI_faction_resource@THIS = 50 }
		set_variable = { 2.NRI_faction_control@THIS = 25 }
		set_variable = { 2.NRI_faction_resource@THIS = 50 }
		set_variable = { 3.NRI_faction_control@THIS = 25 }
		set_variable = { 3.NRI_faction_resource@THIS = 50 }
		set_variable = { 4.NRI_faction_control@THIS = 25 }
		set_variable = { 4.NRI_faction_resource@THIS = 50 }
	}

	# Downtown
	5 = {
		set_variable = { 1.NRI_faction_control@THIS = 25 }
		set_variable = { 1.NRI_faction_resource@THIS = 50 }
		set_variable = { 2.NRI_faction_control@THIS = 25 }
		set_variable = { 2.NRI_faction_resource@THIS = 50 }
		set_variable = { 3.NRI_faction_control@THIS = 25 }
		set_variable = { 3.NRI_faction_resource@THIS = 50 }
		set_variable = { 4.NRI_faction_control@THIS = 25 }
		set_variable = { 4.NRI_faction_resource@THIS = 50 }
	}

	# Central Section
	6 = {
		set_variable = { 1.NRI_faction_control@THIS = 25 }
		set_variable = { 1.NRI_faction_resource@THIS = 50 }
		set_variable = { 2.NRI_faction_control@THIS = 25 }
		set_variable = { 2.NRI_faction_resource@THIS = 50 }
		set_variable = { 3.NRI_faction_control@THIS = 25 }
		set_variable = { 3.NRI_faction_resource@THIS = 50 }
		set_variable = { 4.NRI_faction_control@THIS = 25 }
		set_variable = { 4.NRI_faction_resource@THIS = 50 }
	}

	# Capitol District
	7 = {
		set_variable = { 1.NRI_faction_control@THIS = 25 }
		set_variable = { 1.NRI_faction_resource@THIS = 50 }
		set_variable = { 2.NRI_faction_control@THIS = 25 }
		set_variable = { 2.NRI_faction_resource@THIS = 50 }
		set_variable = { 3.NRI_faction_control@THIS = 25 }
		set_variable = { 3.NRI_faction_resource@THIS = 50 }
		set_variable = { 4.NRI_faction_control@THIS = 25 }
		set_variable = { 4.NRI_faction_resource@THIS = 50 }
	}

	clear_array = NRI_norilsk_campaign_region_array
	clear_array = NRI_norilsk_campaign_ai_region_array

	for_loop_effect = {
		start = 1
		end = 7
		compare = less_than_or_equals

		set_temp_variable = { global.temp_region_id = v }
		add_to_array = { NRI_norilsk_campaign_region_array = v }
		add_to_array = { NRI_norilsk_campaign_ai_region_array = v }

		clear_array = global.temp_region_id:NRI_norilsk_campaign_faction_array

		for_loop_effect = {
			start = 1
			end = 4
			compare = less_than_or_equals

			add_to_array = { global.temp_region_id:NRI_norilsk_campaign_faction_array = v }
		}
	}

	set_variable = { 1.NRI_faction_manpower = 3500 }
	set_variable = { 2.NRI_faction_manpower = 3500 }
	set_variable = { 3.NRI_faction_manpower = 3500 }
	set_variable = { 4.NRI_faction_manpower = 3500 }

	set_variable = { 1.ai_region = 1 }
	clear_array = 1.NRI_region_control_array
	set_variable = { 2.ai_region = 2 }
	clear_array = 2.NRI_region_control_array
	set_variable = { 3.ai_region = 3 }
	clear_array = 3.NRI_region_control_array
	set_variable = { 4.ai_region = 4 }
	clear_array = 4.NRI_region_control_array

	NRI_norilsk_campaign_sort = yes
}

NRI_norilsk_campaign_sort = {
	for_each_loop = {
		array = NRI_norilsk_campaign_region_array

		set_temp_variable = { global.temp_region_target_id = v }

		var:global.temp_region_target_id = {
			for_each_loop = {
				array = NRI_norilsk_campaign_faction_array

				set_temp_variable = { temp_value = v:NRI_faction_control@global.temp_region_target_id }
				multiply_temp_variable = { temp_value = 10 }
				add_to_temp_variable = { temp_value = v }
				add_to_array = { NRI_norilsk_campaign_faction_sort_array = temp_value }
			}

			clear_array = NRI_norilsk_campaign_faction_array

			set_temp_variable = { length_temp = NRI_norilsk_campaign_faction_sort_array^num }

			for_loop_effect = {
				start = 0
				end = length_temp
				value = v

				find_highest_in_array = { array = NRI_norilsk_campaign_faction_sort_array value = max }
				remove_from_array = { NRI_norilsk_campaign_faction_sort_array = max }
				add_to_array = { NRI_norilsk_campaign_faction_array = max }
			}

			for_each_loop = {
				array = NRI_norilsk_campaign_faction_array

				modulo_variable = { NRI_norilsk_campaign_faction_array^i = 10 }
			}

			set_temp_variable = { temp_region_highest = NRI_norilsk_campaign_faction_array^0 }
			set_variable = { NRI_norilsk_campaign_frame = temp_region_highest:NRI_faction_control@global.temp_region_target_id }
			multiply_variable = { NRI_norilsk_campaign_frame = 10 }
			add_to_variable = { NRI_norilsk_campaign_frame = NRI_norilsk_campaign_faction_array^0 }
		}
	}

	add_to_variable = { NRI.show_NRI_norilsk_campaign = 1 }
}

NRI_norilsk_campaign_modify_influence = {
	set_temp_variable = { temp_total = temp_faction:NRI_faction_control@var:temp_region }
	set_temp_variable = { temp_before = temp_total }
	set_temp_variable = { temp_after = temp_total }
	add_to_temp_variable = { temp_total = temp_control }

	if = {
		limit = {
			check_variable = { temp_total > 99 }
		}
		subtract_from_temp_variable = { temp_total = 99 }
		subtract_from_temp_variable = { temp_control = temp_total }
	}
	else_if = {
		limit = {
			check_variable = { temp_total < 0 }
		}
		multiply_temp_variable = { temp_total = -1 }
		add_to_temp_variable = { temp_control = temp_total }
	}

	set_temp_variable = { temp_control = temp_control }
	add_to_temp_variable = { temp_after = temp_control }

	set_variable = { highest_check_1 = temp_region:NRI_norilsk_campaign_faction_array^0 }

	set_temp_variable = { temp_region:temp_control = temp_control }
	set_temp_variable = { temp_region:temp_faction = temp_faction }
	set_temp_variable = { global.temp_target_region = temp_region }

	custom_effect_tooltip = NRI_norilsk_campaign_modify_influence_tt

	var:temp_region = {
		clear_array = temp_array

		for_each_loop = {
			array = NRI_norilsk_campaign_faction_array

			if = {
				limit = {
					check_variable = { temp_faction = v }
				}
				set_temp_variable = { temp_faction_index = i }
			}
		}

		for_loop_effect = {
			start = 0
			end = NRI_norilsk_campaign_faction_array^num

			add_to_array = { temp_array = v }
		}

		remove_from_array = { array = temp_array value = temp_faction_index }

		set_temp_variable = { temp_current_region = NRI_norilsk_campaign_faction_array^temp_faction_index }
		add_to_variable = { temp_current_region:NRI_faction_control@global.temp_target_region = temp_control }

		if = {
			limit = {
				check_variable = { temp_control > 0 }
			}
			while_loop_effect = {
				limit = {
					check_variable = { temp_control > 0 }
				}
				for_loop_effect = {
					start = 0
					end = temp_array^num

					if = {
						limit = {
							set_temp_variable = { temp_current_region = NRI_norilsk_campaign_faction_array^temp_array^v }
							check_variable = { temp_current_region:NRI_faction_control@global.temp_target_region > 0 }
							check_variable = { temp_control > 0 }
						}
						subtract_from_variable = { temp_current_region:NRI_faction_control@global.temp_target_region = 1 }
						subtract_from_temp_variable = { temp_control = 1 }
					}
				}
			}
		}
		else_if = {
			limit = {
				check_variable = { temp_popularity < 0 }
			}
			while_loop_effect = {
				limit = {
					check_variable = { temp_control < 0 }
				}
				for_loop_effect = {
					start = 0
					end = temp_array^num

					if = {
						limit = {
							set_temp_variable = { temp_current_region = NRI_norilsk_campaign_faction_array^temp_array^v }
							check_variable = { temp_current_region:NRI_faction_control@global.temp_target_region < 99 }
							check_variable = { temp_control < 0 }
						}
						add_to_variable = { temp_current_region:NRI_faction_control@global.temp_target_region = 1 }
						add_to_temp_variable = { temp_control = 1 }
					}
				}
			}
		}
	}

	NRI_norilsk_campaign_sort = yes

	set_variable = { highest_check_2 = temp_region:NRI_norilsk_campaign_faction_array^0 }

	if = {
		limit = {
			NOT = {
				check_variable = { highest_check_1 = highest_check_2 }
			}
		}
		if = {
			limit = {
				is_in_array = { 1.NRI_region_control_array = temp_region }
			}
			remove_from_array = { 1.NRI_region_control_array = temp_region }
		}
		if = {
			limit = {
				is_in_array = { 2.NRI_region_control_array = temp_region }
			}
			remove_from_array = { 2.NRI_region_control_array = temp_region }
		}
		if = {
			limit = {
				is_in_array = { 3.NRI_region_control_array = temp_region }
			}
			remove_from_array = { 3.NRI_region_control_array = temp_region }
		}
		if = {
			limit = {
				is_in_array = { 4.NRI_region_control_array = temp_region }
			}
			remove_from_array = { 4.NRI_region_control_array = temp_region }
		}
		add_to_array = { temp_faction:NRI_region_control_array = temp_region }
	}
}

NRI_norilsk_campaign_modify_manpower = {
	set_temp_variable = { temp_before = temp_faction:NRI_faction_manpower }
	set_temp_variable = { temp_after = temp_before }
	add_to_temp_variable = { temp_after = temp_manpower }
	set_variable = { temp_faction:NRI_faction_manpower = temp_after }

	custom_effect_tooltip = NRI_norilsk_campaign_modify_manpower_tt
	add_to_variable = { NRI.show_NRI_norilsk_campaign = 1 }
}

NRI_norilsk_campaign_modify_resource = {
	set_temp_variable = { temp_before = temp_faction:NRI_faction_resource@var:temp_region }
	set_temp_variable = { temp_after = temp_before }
	add_to_temp_variable = { temp_after = temp_resource }
	set_variable = { temp_faction:NRI_faction_resource@var:temp_region = temp_after }

	custom_effect_tooltip = NRI_norilsk_campaign_modify_resource_tt
	add_to_variable = { NRI.show_NRI_norilsk_campaign = 1 }
}
